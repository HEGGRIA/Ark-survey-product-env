import{E as T,x as b,u as O,r as p,j as e,G as B,C as X,d as q,b as x,ao as pe,P as Fe,y as v,Q as D,ap as te,aq as G,c as j,ar as se,as as re,at as oe,F as $,am as z,B as M,V as le,W as ce,au as ge,T as ae,S as Ee,ae as w,af as me,an as P,av as ye,aw as ke,ax as fe,ay as Be,p as Q,Y as Ce,a as Ie,e as _}from"./index.96a5bef5.js";import{I as H,a as de,u as he}from"./Header.34f7f982.js";import{u as Se,a as R,I as Ae}from"./index.da33871c.js";import{m as A,I as N,a as De,b as Ke}from"./PageContainer.4d5a3c80.js";import{C as Y}from"./index.ba3a0486.js";import{D as f}from"./DraggableCharContainer.6b632dbf.js";import{u as be,a as ee}from"./useQuery.a6cfda6a.js";import"./use-uncontrolled.458e066f.js";import"./use-id.89442731.js";import"./SegmentedControl.bd03abd8.js";import"./Container.2d16d092.js";import"./TextInput.19bf78d9.js";function xe({filterChar:n}){const{charMap:t}=T(),{setting:s}=b(),{t:i}=O(),{editingCharKey:l,updateEditingCharKey:u}=Se(),{charBox:c}=R(),o=p.exports.useMemo(()=>{var r;return(r=c==null?void 0:c.characterKeys)!=null?r:{}},[c==null?void 0:c.characterKeys]),a=p.exports.useMemo(()=>A(t).filter(r=>!r.isNotObtainable&&Object.keys(o).filter(F=>F===r.key).length>0&&n(r)).map(r=>{var F,y;return e(Y,{selecting:l===(r==null?void 0:r.key),onSelectChange:()=>u(r==null?void 0:r.key),charKey:(F=o[r.key].skinUse)!=null?F:"",charName:(y=r==null?void 0:r.name)!=null?y:"",nameDisplay:s.nameDisplay,mini:s.mini,dragDisabled:!0},o[r.key].skinUse)}),[o,t,l,n,s.mini,s.nameDisplay,u]);return a.length>0?e(B,{spacing:10,position:"center",children:a}):e(X,{sx:{height:"100%"},children:e(q,{color:"#ccc",children:i("no-qualified")})})}function Oe({filterChar:n,onClickFilter:t}){const{setting:s,setSettingKeyValue:i}=b(),{charMap:l}=T(),{charBox:u}=R(),c=p.exports.useMemo(()=>{var a;return(a=u==null?void 0:u.characterKeys)!=null?a:{}},[u==null?void 0:u.characterKeys]),o=p.exports.useMemo(()=>{const a=A(c);return A(l).filter(r=>a.findIndex(F=>F.key===r.key)>-1&&n(r))},[l,c,n]);return x(pe,{position:{bottom:0,right:0},zIndex:100,children:[e(f,{}),x(Fe,{radius:0,p:"md",sx:{width:"100vw",height:"200px",display:"flex"},children:[x(v,{pr:10,children:[e(D,{size:"lg",onClick:()=>i("charBoxEditing",!s.charBoxEditing),children:e(te,{})}),e(H,{label:o.length,size:16,children:e(D,{size:"lg",onClick:t,children:e(G,{})})})]}),e(j,{sx:{height:"100%",overflow:"auto",flex:1},children:e(xe,{filterChar:n})})]})]})}function ve({character:n,selecting:t,onSelect:s,onSelectCancel:i}){var c,o;const{setting:l}=b(),u=a=>{var r,F;a?s==null||s((r=n==null?void 0:n.key)!=null?r:""):i==null||i((F=n==null?void 0:n.key)!=null?F:"")};return e(Y,{nameDisplay:l.nameDisplay,charKey:(c=n==null?void 0:n.key)!=null?c:"",charName:(o=n==null?void 0:n.name)!=null?o:"",mini:l.mini,selecting:t,dragDisabled:!0,sx:{zIndex:0},onSelectChange:u})}function ne({filterCharData:n,selectKeys:t,...s}){const{t:i}=O(),l=p.exports.useMemo(()=>n.map((u,c)=>{var o;return e(ve,{selecting:t.findIndex(a=>a===(u==null?void 0:u.key))>-1,character:u,...s},(o=u==null?void 0:u.key)!=null?o:"")}),[n,s,t]);return e(B,{spacing:10,position:"center",children:l.length>0?l:e(X,{children:e(q,{color:"#ccc",children:i("no-qualified")})},"none")})}function we({filterChar:n,onClickFilter:t}){const{charMap:s}=T(),{charBox:i,addCharToBox:l,delCharFromBox:u,isLoading:c}=R(),{setting:o,setSettingKeyValue:a}=b();O();const[r,F]=p.exports.useState([]),[y,k]=p.exports.useState([]),I=p.exports.useMemo(()=>{var m;const h=A((m=i==null?void 0:i.characterKeys)!=null?m:{});return A(s).filter(g=>h.findIndex(K=>K.key===g.key)>-1&&n(g))},[i,s,n]),C=p.exports.useMemo(()=>A(s).filter(h=>h.isNotObtainable?!1:I.findIndex(m=>m.key===h.key)===-1&&n(h)),[s,I,n]),L=C.length!==0&&C.length===y.length,U=()=>{k(L?[]:C.map(h=>h.key))},d=()=>{u.mutate(r),F([])},E=()=>{const h=[...C].filter(g=>y.findIndex(K=>K===g.key)>-1),m={};h.forEach(g=>{var Z;const K={};Object.keys({...g.skills}).forEach(S=>{K[S]={level:1,key:S}});const J={};Object.keys({...g.equips}).forEach(S=>{J[S]={level:0,key:S}}),m[g.key]={key:g.key,moduleUse:"",skillUse:(Z=Object.keys(g.skills).find(S=>g.skills[S].index===0))!=null?Z:"",skinUse:Object.keys(g.skins)[0],favorite:!1,level:1,elite:0,trust:200,potentialLevel:0,skills:K,modules:J}}),l.mutate(m),k([])};return e(N,{loading:c,children:x(v,{children:[e(de,{title:o.charBoxEditing?"\u5E72\u5458\u76D2":"\u6301\u6709\u7F16\u8F91",children:x(B,{position:"right",spacing:10,children:[!o.charBoxEditing&&e(D,{size:"lg",radius:"md",onClick:U,children:L?e(se,{}):y.length!==0?e(re,{}):e(oe,{})}),e(H,{label:o.charBoxEditing?I.length:C.length,size:16,children:e(D,{size:"lg",radius:"md",onClick:t,children:e(G,{})})})]})}),e(f,{}),o.charBoxEditing?e(z,{sx:{height:o.charBoxEditing?"850px":"370px"},children:e(xe,{filterChar:n})}):x($,{children:[e(z,{sx:{height:"370px"},children:e(ne,{filterCharData:C,selectKeys:y,onSelect:h=>k([...y,h]),onSelectCancel:h=>k(m=>m.filter(g=>g!==h))})}),e(f,{}),x(B,{position:"center",children:[e(M,{leftIcon:e(le,{}),size:"xs",color:"red",variant:"outline",onClick:d,children:"\u79FB\u81F3\u672A\u6301\u6709"}),e(M,{leftIcon:e(ce,{}),size:"xs",variant:"outline",onClick:E,children:"\u79FB\u81F3\u5DF2\u6301\u6709"})]}),e(f,{}),e(z,{sx:{height:o.charBoxEditing?"":"370px"},children:e(ne,{filterCharData:I,selectKeys:r,onSelect:h=>F([...r,h]),onSelectCancel:h=>F(m=>m.filter(g=>g!==h))})})]}),e(f,{}),e(B,{position:"center",children:e(M,{variant:o.charBoxEditing?"outline":"filled",color:"indigo",leftIcon:e(te,{}),onClick:()=>a("charBoxEditing",!o.charBoxEditing),children:o.charBoxEditing?"\u7EC3\u5EA6\u7F16\u8F91\u6A21\u5F0F":"\u6301\u6709\u7F16\u8F91\u6A21\u5F0F"})})]})})}function ze(){const{setting:n}=b(),{downSM:t}=ge(),{setOpened:s,drawerContext:i,filterChar:l}=he();return x($,{children:[n.charBoxEditing&&t?!n.menuOpened&&e(Oe,{filterChar:l,onClickFilter:()=>s(!0)}):e(we,{filterChar:l,onClickFilter:()=>s(!0)}),n.charBoxEditing&&e(Ae,{}),i]})}function Me(){return x(N,{children:[e(ae,{order:5,children:"\u586B\u5199\u4F60\u7684 BOX \u4E0E\u76AE\u80A4\u6301\u6709\u60C5\u51B5"}),e(Ee,{h:5}),x(w,{children:[e(w.Item,{children:"\u8FDB\u5165\u9875\u9762\u540E\uFF0C\u5148\u9009\u62E9\u4F60\u6301\u6709\u7684\u5E72\u5458\uFF0C\u4FDD\u5B58\u540E\u70B9\u51FB\u6700\u4E0B\u65B9\u7684\u3010\u6301\u6709\u7F16\u8F91\u6A21\u5F0F\u3011\u6309\u94AE\u5207\u6362\u5230\u3010\u7EC3\u5EA6\u7F16\u8F91\u6A21\u5F0F\u3011\u9875\u9762\u3002"}),e(w.Item,{children:"\u76AE\u80A4\u76D2\u529F\u80FD\u9884\u8BA1\u4E8E 0.5 \u7248\u672C\u66F4\u65B0\uFF0C\u5728\u6B64\u4E4B\u524D\u6240\u6709\u76AE\u80A4\u7686\u53EF\u81EA\u7531\u9009\u62E9\uFF0C\u5F85\u529F\u80FD\u66F4\u65B0\u540E\u8BF7\u5148\u63D0\u4EA4\u4E00\u6B21\u76AE\u80A4\u6301\u6709\u60C5\u51B5\uFF0C\u4E4B\u540E\u4FBF\u53EF\u6B63\u5E38\u7F16\u8F91 BOX\u3002"}),e(w.Item,{children:e("del",{children:"\u4F60\u53EF\u4EE5\u5207\u6362\u4F60\u5DF2\u7ECF\u6301\u6709\u7684\u5E72\u5458\u76AE\u80A4\uFF0C\u7CBE\u4E8C\u76AE\u80A4\u5728\u7CBE\u4E8C\u540E\u89E3\u9501\u3002"})}),e(w.Item,{children:e("del",{children:"\u8981\u60F3\u89E3\u9501\u672A\u6301\u6709\u7684\u5E72\u5458\u76AE\u80A4\uFF0C\u8BF7\u70B9\u51FB\u5E72\u5458\u76AE\u80A4\u53F3\u4E0A\u89D2\u7684\u3010+\u3011\u6309\u94AE\uFF0C\u6B64\u64CD\u4F5C\u4F1A\u63D0\u4EA4\u81F3\u76AE\u80A4\u76D2\u66F4\u6539\u3002"})})]})]})}const ue=[{value:"char",label:"\u5E72\u5458 BOX \u7F16\u8F91",icon:e(fe,{})},{value:"skin",label:"\u76AE\u80A4\u6301\u6709\u7F16\u8F91",icon:e(Be,{})}];function $e({inside:n,onInside:t}){var l;const[s,i]=p.exports.useState(0);return x($,{children:[e(De,{title:n?(l=ue[s])==null?void 0:l.label:"\u5E72\u5458\u6570\u636E",inside:n,children:e(D,{size:"md",children:e(me,{onClick:()=>t==null?void 0:t(!1)})})}),!n&&x($,{children:[e(Me,{}),e(N,{children:x(v,{children:[e(B,{noWrap:!0,children:ue.map((u,c)=>e(P,{onClick:()=>{i(c),t==null||t(!0,u.value)},children:e(W,{label:u.label,topIcon:u.icon,titleProps:{sx:{fontSize:"16px",width:"100%"}},groupsSx:{alignItems:"center",justifyContent:"center"}})},c))}),e(f,{}),x(B,{noWrap:!0,children:[e(P,{sx:{textAlign:"center"},disabled:!0,children:e(W,{label:"\u5FEB\u901F\u5BFC\u5165\u6570\u636E",topIcon:e(ye,{}),titleProps:{sx:{fontSize:"16px",width:"100%"}},groupsSx:{alignItems:"center",justifyContent:"center"}})}),e(P,{sx:{textAlign:"center"},disabled:!0,children:e(W,{label:"\u5BFC\u51FA\u6570\u636E",topIcon:e(ke,{}),titleProps:{sx:{fontSize:"16px",width:"100%"}},groupsSx:{alignItems:"center",justifyContent:"center"}})})]})]})})]})]})}const W=({label:n,description:t,titleProps:s,groupsSx:i,topIcon:l,sx:u,...c})=>e(j,{sx:u,...c,children:x(v,{sx:{height:"100%",alignItems:"flex-start",...i},children:[l,x(j,{children:[e(ae,{order:5,...s,children:n}),x(q,{size:"xs",color:"dimmed",children:[t&&e(f,{}),t]})]})]})});function Le({data:n,selecting:t,onSelect:s,onSelectCancel:i}){var c;const{setting:l}=b(),u=o=>{var a,r;o?s==null||s((a=n==null?void 0:n.skinKey)!=null?a:""):i==null||i((r=n==null?void 0:n.skinKey)!=null?r:"")};return e(Y,{charKey:(c=n==null?void 0:n.skinKey)!=null?c:"",mini:l.mini,selecting:t,dragDisabled:!0,sx:{zIndex:0},onSelectChange:u})}function ie({filterData:n,selectKeys:t,...s}){const{t:i}=O(),l=p.exports.useMemo(()=>n.map((u,c)=>{var o;return e(Le,{data:u,selecting:t.findIndex(a=>a===(u==null?void 0:u.skinKey))>-1,...s},(o=u==null?void 0:u.skinKey)!=null?o:"")}),[n,s,t]);return e(B,{spacing:10,position:"center",children:l.length>0?l:e(X,{children:e(q,{color:"#ccc",children:i("no-qualified")})},"none")})}class V{constructor(){this.serviceName="charSkinBox"}getCharSkinBoxByUserId(t){return Q(this.serviceName,"getCharSkinBoxByUserId",t)}createOne(t){return Q(this.serviceName,"createOne",t)}updateOne(t){return Q(this.serviceName,"updateOne",t)}}const je={id:"",userId:"",charSkinKeys:[],updatedDate:""};function Te(){const n=Ce();O();const t=p.exports.useRef("skin-box"),{user:s}=Ie(),{isLoading:i,error:l,data:u}=be(t.current,async()=>{const{data:a}=await new V().getCharSkinBoxByUserId({userId:s.id});return a||je}),c=ee(async()=>u!=null&&u.id?await new V().updateOne({charSkinBox:{...u,userId:s.id}}):await new V().createOne({charSkinBox:{...u,userId:s.id}}),{onSuccess:()=>{}}),o=ee(async a=>{n.setQueryData(t.current,a)},{onSuccess:()=>{c.mutate()}});return{skinBox:u,uploadSkinBox:c,updateLocalSkinBox:o,isLoading:i}}function qe({filterChar:n,onClickFilter:t}){const{charMap:s}=T();O();const{skinBox:i,updateLocalSkinBox:l,isLoading:u}=Te(),[c,o]=p.exports.useState([]),[a,r]=p.exports.useState([]),F=p.exports.useMemo(()=>{let d=[];return A(s).forEach((E,h)=>{d.push(...Object.keys(E.skins).map(m=>({skinKey:m,...E})).filter(m=>m.skinKey.includes("#")))}),d},[s]),y=p.exports.useMemo(()=>F.filter(d=>{var E;return((E=i==null?void 0:i.charSkinKeys)==null?void 0:E.find(h=>h===d.skinKey))&&n(d)}),[F,n,i==null?void 0:i.charSkinKeys]),k=p.exports.useMemo(()=>F.filter(d=>y.findIndex(E=>E.key===d.key)===-1&&n(d)),[F,n,y]),I=k.length!==0&&k.length===a.length,C=()=>{r(I?[]:k.map(d=>d.skinKey))},L=()=>{var d;if(a.length===0){_("\u8BF7\u5148\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A\u672A\u6301\u6709\u7684\u76AE\u80A4\uFF01");return}l.mutate({...i,charSkinKeys:[...(d=i==null?void 0:i.charSkinKeys)!=null?d:[],...a]}),r([])},U=()=>{var d;if(c.length===0){_("\u8BF7\u5148\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A\u5DF2\u6301\u6709\u7684\u76AE\u80A4\uFF01");return}l.mutate({...i,charSkinKeys:(d=i==null?void 0:i.charSkinKeys)==null?void 0:d.filter(E=>!c.includes(E))}),o([])};return e(N,{loading:u,children:x(v,{children:[e(de,{title:"\u6301\u6709\u7F16\u8F91",children:x(B,{position:"right",spacing:10,children:[e(D,{size:"lg",radius:"md",onClick:C,children:I?e(se,{}):a.length!==0?e(re,{}):e(oe,{})}),e(H,{label:k.length,size:16,children:e(D,{size:"lg",radius:"md",onClick:t,children:e(G,{})})})]})}),e(f,{}),e(z,{sx:{height:"370px"},children:e(ie,{filterData:k,selectKeys:a,onSelect:d=>r([...a,d]),onSelectCancel:d=>r(E=>E.filter(h=>h!==d))})}),e(f,{}),x(B,{position:"center",children:[e(M,{leftIcon:e(le,{}),size:"xs",color:"red",variant:"outline",onClick:U,children:"\u79FB\u81F3\u672A\u6301\u6709"}),e(M,{leftIcon:e(ce,{}),size:"xs",variant:"outline",onClick:L,children:"\u79FB\u81F3\u5DF2\u6301\u6709"})]}),e(f,{}),e(z,{sx:{height:"370px"},children:e(ie,{filterData:y,selectKeys:c,onSelect:d=>o([...c,d]),onSelectCancel:d=>o(E=>E.filter(h=>h!==d))})})]})})}function Ne(){const{setOpened:n,drawerContext:t,filterChar:s}=he();return x($,{children:[e(qe,{filterChar:s,onClickFilter:()=>n(!0)}),t]})}function _e(){const[n,t]=p.exports.useState(!1),[s,i]=p.exports.useState("char");return e(Ke,{children:x(v,{children:[e($e,{inside:n,onInside:(l,u)=>{t(l),i(u!=null?u:"")}}),n&&e(j,{sx:{display:"flex",gap:"20px",flexWrap:"wrap"},children:s==="char"?e(ze,{}):e(Ne,{})})]})})}export{_e as default};
