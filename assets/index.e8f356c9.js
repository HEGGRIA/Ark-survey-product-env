import{q as we,R as ke,f as F,r as I,g as Ie,j as t,b,c as d,H as A,P as J,d as R,B as Q,J as de,K as fe,M as T,u as xe,N as Ne,F as Y,Q as Oe,G,T as le,V as oe,z as se,W as ze,X as _e,S as Pe,C as X,Y as Se,p as Z,Z as Ee,a as je}from"./index.5cc7f48e.js";import{D as he,I as me,u as Be,a as We}from"./DraggableCharContainer.396d5508.js";import{S as te}from"./SegmentedControl.93cdda22.js";import{N as q,u as $e,a as L}from"./useQuery.e0c9f0c5.js";import{C as Ke}from"./index.cbd0ef98.js";function Re({size:s,thickness:e,sum:r,value:i,root:x,offset:f}){const a=(s*.9-e*2)/2,l=Math.PI*a*2/100,u=x?`${(100-r)*l}, ${r*l}`:`${i*l}, ${(100-i)*l}`;return{strokeWidth:e,cx:s/2,cy:s/2,r:a,transform:x?`scale(1, -1) translate(0, -${s})`:null,strokeDasharray:u,strokeDashoffset:x?0:f}}var Me=Object.defineProperty,ie=Object.getOwnPropertySymbols,Ae=Object.prototype.hasOwnProperty,Fe=Object.prototype.propertyIsEnumerable,ne=(s,e,r)=>e in s?Me(s,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[e]=r,Te=(s,e)=>{for(var r in e||(e={}))Ae.call(e,r)&&ne(s,r,e[r]);if(ie)for(var r of ie(e))Fe.call(e,r)&&ne(s,r,e[r]);return s};function be({size:s,value:e,offset:r,sum:i,thickness:x,root:f,color:a,lineRoundCaps:l}){const u=we(),p=u.fn.themeColor(a||(u.colorScheme==="dark"?"dark":"gray"),a?u.fn.primaryShade():u.colorScheme==="dark"?4:1,!1);return ke.createElement("circle",Te({fill:"none",strokeLinecap:l?"round":"butt",stroke:p},Re({sum:i,size:s,thickness:x,value:e,offset:r,root:f})))}be.displayName="@mantine/core/Curve";var Le=Object.defineProperty,Ue=Object.defineProperties,Ve=Object.getOwnPropertyDescriptors,ce=Object.getOwnPropertySymbols,De=Object.prototype.hasOwnProperty,Ge=Object.prototype.propertyIsEnumerable,ae=(s,e,r)=>e in s?Le(s,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[e]=r,U=(s,e)=>{for(var r in e||(e={}))De.call(e,r)&&ae(s,r,e[r]);if(ce)for(var r of ce(e))Ge.call(e,r)&&ae(s,r,e[r]);return s},V=(s,e)=>Ue(s,Ve(e));function Qe({size:s,thickness:e,sections:r,renderRoundedLineCaps:i}){const x=r.reduce((p,h)=>p+h.value,0),f=Math.PI*((s*.9-e*2)/2)*2;let a=f;const l=[],u=[];for(let p=0;p<r.length;p+=1)l.push({sum:x,offset:a,data:r[p],root:!1}),a-=r[p].value/100*f;if(l.push({sum:x,offset:a,data:null,root:!0}),u.push(V(U({},l[l.length-1]),{lineRoundCaps:!1})),l.length>2){u.push(V(U({},l[0]),{lineRoundCaps:i})),u.push(V(U({},l[l.length-2]),{lineRoundCaps:i}));for(let p=1;p<=l.length-3;p+=1)u.push(V(U({},l[p]),{lineRoundCaps:!1}))}else u.push(V(U({},l[0]),{lineRoundCaps:i}));return u}var Ye=F({root:{position:"relative"},label:{position:"absolute",top:"50%",transform:"translateY(-50%)"}}),He=Ye,Je=Object.defineProperty,H=Object.getOwnPropertySymbols,ge=Object.prototype.hasOwnProperty,ve=Object.prototype.propertyIsEnumerable,ue=(s,e,r)=>e in s?Je(s,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[e]=r,pe=(s,e)=>{for(var r in e||(e={}))ge.call(e,r)&&ue(s,r,e[r]);if(H)for(var r of H(e))ve.call(e,r)&&ue(s,r,e[r]);return s},Xe=(s,e)=>{var r={};for(var i in s)ge.call(s,i)&&e.indexOf(i)<0&&(r[i]=s[i]);if(s!=null&&H)for(var i of H(s))e.indexOf(i)<0&&ve.call(s,i)&&(r[i]=s[i]);return r};const Ze={size:120,thickness:12},D=I.exports.forwardRef((s,e)=>{const r=Ie("RingProgress",Ze,s),{className:i,style:x,label:f,sections:a,size:l,thickness:u,classNames:p,styles:h,roundCaps:o,unstyled:v}=r,g=Xe(r,["className","style","label","sections","size","thickness","classNames","styles","roundCaps","unstyled"]),{classes:k,cx:N}=He(null,{classNames:p,styles:h,unstyled:v,name:"RingProgress"}),z=Qe({size:l,thickness:u,sections:a,renderRoundedLineCaps:o}).map((n,m)=>{var y,P;return t(be,{value:(y=n.data)==null?void 0:y.value,size:l,thickness:u,sum:n.sum,offset:n.offset,color:(P=n.data)==null?void 0:P.color,root:n.root,lineRoundCaps:n.lineRoundCaps},m)});return b(d,{...pe({style:pe({width:l,height:l},x),className:N(k.root,i),ref:e},g),children:[t("svg",{width:l,height:l,style:{transform:"rotate(-90deg)"},children:z}),f&&t("div",{className:k.label,style:{right:u*2,left:u*2},children:f})]})});D.displayName="@mantine/core/RingProgress";const qe=F((s,{fold:e})=>({container:{position:"relative",background:s.white,borderRadius:"10px",width:335},ringContainer:{display:"flex",alignItems:"center",padding:7,boxSizing:"border-box",userSelect:"none",paddingTop:"16px"},bottomBox:{transition:"all 0.5s",overflow:"hidden",position:"relative",width:"100%",height:e?40:195,zIndex:2},folderButton:{transition:"all 0.5s",display:"flex",flexWrap:"wrap",width:"100%",height:40,overflow:"hidden",padding:"5px",boxSizing:"border-box"},detailBarSlider:{height:"100%"},numberInput:{},detailName:{fontWeight:700,marginTop:4,fontSize:s.fontSizes.xs,marginBottom:4,height:19}}));function Ce({onClickFoldButton:s,data:e,verifyRule:r,maxEliteVerifyRule:i,maxLevelVerifyRule:x,fold:f=!1,onCharBasicDataChange:a}){var v,g,k,N,z,n,m,y,P,E,$;const{classes:l,cx:u}=qe({fold:f}),{charMap:p}=A(),h=p[e.key].rarity,o=I.exports.useMemo(()=>[{value:"0",label:"\u672A\u7CBE\u82F1"},{value:"1",label:"\u7CBE\u4E00"},{value:"2",label:"\u7CBE\u4E8C"}].filter((O,c)=>c<=i[h]),[i,h]);return b(J,{shadow:"md",withBorder:!0,className:l.container,children:[b(d,{className:l.ringContainer,children:[t(D,{size:110,thickness:5,label:b(d,{sx:{position:"relative"},children:[t(R,{sx:{fontSize:"12px",position:"absolute",left:"37px",top:-5,fontWeight:700},align:"center",children:"LV"}),t(R,{sx:{fontSize:"36px"},align:"center",weight:700,children:(v=e==null?void 0:e.level)!=null?v:1})]}),sections:[{value:((g=e==null?void 0:e.level)!=null?g:1)*100/x[e.elite][h],color:"yellow"}]}),t(D,{size:70,thickness:4,label:b(d,{sx:{position:"relative"},children:[t(R,{sx:{fontSize:"12px",position:"absolute",left:"15px",bottom:-35,fontWeight:700},align:"center",children:"\u7CBE\u82F1"}),t(R,{size:"xl",align:"center",children:(k=e==null?void 0:e.elite)!=null?k:0})]}),sections:[{value:((N=e==null?void 0:e.elite)!=null?N:0)*100/i[h],color:"green"}]}),t(D,{size:70,thickness:4,label:b(d,{sx:{position:"relative"},children:[t(R,{sx:{fontSize:"12px",position:"absolute",left:"15px",bottom:-35,fontWeight:700},align:"center",children:"\u6F5C\u80FD"}),t(R,{size:"xl",align:"center",children:(z=e==null?void 0:e.potentialLevel)!=null?z:0})]}),sections:[{value:((n=e==null?void 0:e.potentialLevel)!=null?n:0)*100/r.potentialLevel[1],color:"blue"}]}),t(D,{size:70,thickness:4,label:b(d,{sx:{position:"relative"},children:[t(R,{sx:{fontSize:"12px",position:"absolute",left:"15px",bottom:-35,fontWeight:700},align:"center",children:"\u4FE1\u8D56"}),t(R,{size:"xl",align:"center",children:(m=e==null?void 0:e.trust)!=null?m:0})]}),sections:[{value:((y=e==null?void 0:e.trust)!=null?y:0)*100/r.trust[1],color:"orange"}]})]}),t(d,{sx:{transition:"all 0.5s",position:"absolute",top:9,right:16,fontWeight:700},children:"\u6570\u503C"}),b(d,{className:l.bottomBox,children:[t(d,{className:l.folderButton,children:t(Q,{variant:"subtle",sx:{width:"100%",height:"100%"},onClick:()=>s==null?void 0:s(!f),children:f?t(de,{size:30}):t(fe,{size:30})})}),t(he,{}),b(T,{gutter:"sm",sx:{margin:"5px 10px"},children:[b(T.Col,{span:6,className:l.detailBarSlider,children:[t(d,{className:l.detailName,children:"\u7CBE\u82F1\u9636\u6BB5"}),t(te,{value:e.elite.toString(),onChange:_=>a==null?void 0:a({...e,elite:parseInt(_!=null?_:"0",10)}),size:"xs",data:o})]}),t(T.Col,{span:6,className:l.numberInput,children:t(q,{value:(P=e==null?void 0:e.level)!=null?P:1,onChange:_=>a==null?void 0:a({...e,level:_!=null?_:1}),label:"\u7B49\u7EA7",labelProps:{style:{fontWeight:700}},size:"xs",min:1,max:x[e.elite][h]})}),t(T.Col,{span:6,className:l.numberInput,children:t(q,{value:(E=e==null?void 0:e.potentialLevel)!=null?E:0,onChange:_=>a==null?void 0:a({...e,potentialLevel:_!=null?_:0}),label:"\u6F5C\u80FD",labelProps:{style:{fontWeight:700}},size:"xs",min:r.potentialLevel[0],max:r.potentialLevel[1]})}),t(T.Col,{span:6,className:l.numberInput,children:t(q,{value:($=e==null?void 0:e.trust)!=null?$:0,onChange:_=>a==null?void 0:a({...e,trust:_!=null?_:0}),label:"\u4FE1\u8D56",labelProps:{style:{fontWeight:700}},size:"xs",min:r.trust[0],max:r.trust[1]})})]})]})]})}function es({imgKey:s,width:e=64,flowWidthRef:r}){const{imgPositionMap:i}=A();return t(me,{url:"https://img.yituliu.site/static/skill_0.5.webp",width:e,originWidth:64,flowWidthRef:r,position:i.skillImgPosition["skill_icon_"+s]})}const ss=F((s,{mini:e,type:r,selecting:i})=>({avatarBox:{userSelect:"none",width:e?30:60,minWidth:e?30:60,height:e?30:60,overflow:"hidden",position:"relative",zIndex:1,boxShadow:"0px 1px 2px 1px "+s.colors.gray[7],margin:s.spacing.xs},nameBox:{position:"absolute",zIndex:2,top:e?"1px":"66px",left:e?"-50%":"0px",width:e?"200%":"100%",display:"flex",alignItems:"center",justifyContent:"center",height:"14px",textAlign:"center",transform:e?"scale(0.5)":"",fontSize:"10px",fontWeight:700,background:"linear-gradient(to top, rgba(255,255,255,0.7) 0%, rgba(255,255,255,0.7) 90%, rgba(255,249,242,0) 100%)"}}));function ts({skillKey:s,type:e="default",readonly:r=!s,metaInfo:i,skillStatus:x="default",skillName:f,nameDisplay:a,mini:l,selecting:u,onDelete:p,onSelectChange:h}){var N;const o=Be(()=>u&&(h==null?void 0:h(!u)),["mouseup","touchend"]),{classes:v}=ss({mini:l,type:e,selecting:u}),{t:g}=xe();We(),I.exports.useMemo(()=>t(Ne,{opacity:.6,color:"#000",zIndex:5,sx:{color:"#fff",display:"flex",fontWeight:600,fontSize:l?"10px":"",alignItems:"center",justifyContent:"center"},children:b(d,{children:[x==="picked"&&g("picked"),u&&e==="tier-list"&&g("skillContainer.delete")]})}),[l,g,x,u,e]);const k=()=>{u&&e==="tier-list"?p==null||p():h==null||h(!u)};return t(d,{ref:o,className:v.avatarBox,onClick:k,children:t(d,{children:t(es,{imgKey:s!=null?s:"",width:l?30:60,flowWidthRef:(N=o.current)!=null?N:void 0})})})}const rs=F((s,{fold:e})=>({rankBox:{height:40,width:"75px",background:s.white,fontWeight:700,position:"relative",zIndex:1,border:"1px solid"+s.colors.gray[2],borderRadius:"10px 10px 0 0"},bottomBox:{transition:"all 0.5s",overflow:"hidden",position:"relative",width:"100%",height:e?60:290,borderRadius:"0 10px 10px 10px",zIndex:2},folderButton:{transition:"all 0.5s",display:"flex",flexWrap:"wrap",width:"70px",height:e?50:70,overflow:"hidden",padding:"5px"},skillName:{transition:"all 0.5s",opacity:e?1:0,display:e?"":"none",flex:1,textAlign:"center",fontSize:s.fontSizes.xs,height:"20px",position:"absolute",bottom:"-19px",width:"90px",left:"-5px"},skillIconGroup:{transition:"all 0.5s",position:"absolute",top:e?0:42,left:85,marginRight:"10px",zIndex:3,fontWeight:700},skillELevel:{width:6,height:6,borderRadius:"50%",background:"#fff",position:"absolute"},detailBar:{padding:"14px",paddingTop:"0"},detailBarSlider:{padding:"5px 0",margin:"25px 6px",textAlign:"right",marginBottom:"0",position:"relative"},detailBarSliderNoInfo:{height:30.5,color:"#ccc",textAlign:"right"},detailSkillName:{transition:"all 0.5s",opacity:e?0:1,position:"absolute",top:-16,right:0,fontSize:s.fontSizes.xs,fontWeight:700}}));function ls({data:s,fold:e=!1,onClickFoldButton:r,onSelectSkillChange:i,onSkillLevelChange:x}){var k,N,z;const{classes:f,cx:a}=rs({fold:e}),{elite:l,skills:u,skillUse:p}=s,{charMap:h}=A(),o=I.exports.useMemo(()=>{const n=[{label:"1",value:"1"},{label:"2",value:"2"},{label:"3",value:"3"},{label:"4",value:"4"}];return l&&(l>0&&n.push({label:"5",value:"5"},{label:"6",value:"6"},{label:"7",value:"7"}),l>1&&n.push({label:"\u4E13\u7CBE\u4E00",value:"8"},{label:"\u4E13\u7CBE\u4E8C",value:"9"},{label:"\u4E13\u7CBE\u4E09",value:"10"})),n},[l]),v=h[s.key].skills,g=I.exports.useMemo(()=>{const n=[];return Object.keys(v).sort((m,y)=>v[m].index-v[y].index).forEach((m,y)=>{var P,E,$,_,O;if(y<=l){const c=u[m];n.push(b(d,{sx:{display:"flex",alignItems:"center",flexFlow:"wrap",maxWidth:"80px",position:"relative",userSelect:"none",cursor:"pointer"},onClick:()=>i==null?void 0:i(c==null?void 0:c.key),children:[(c==null?void 0:c.level)>=7&&b(d,{sx:{position:"absolute",fontSize:"12px",textAlign:"center",color:"#fff",left:"5px",top:"5px",width:"16px",height:"16px",zIndex:4,background:"rgba(0,0,0,0.8)"},children:[t(d,{className:f.skillELevel,sx:{top:2,left:5,background:c.level>7?"#fff":"#777"}}),t(d,{className:f.skillELevel,sx:{bottom:2,left:8.5,background:c.level>9?"#fff":"#777"}}),t(d,{className:f.skillELevel,sx:{bottom:2,left:1.5,background:c.level>8?"#fff":"#777"}})]}),p===(c==null?void 0:c.key)&&b(Y,{children:[t(d,{sx:{position:"absolute",fontSize:"12px",textAlign:"center",color:"#fff",right:"5px",top:"5px",width:0,height:0,zIndex:3,border:"14px solid transparent",borderTop:"14px solid rgba(14,140,226,0.9)",borderRight:"14px solid rgba(14,140,226,0.9)"}}),t(d,{sx:{position:"absolute",color:"#fff",right:"2px",top:"2px",zIndex:3,transform:"scale(0.65)"},children:t(Oe,{})})]}),t(ts,{skillKey:(P=c==null?void 0:c.iconId)!=null?P:c==null?void 0:c.key}),t(d,{className:f.skillName,sx:{transform:"scale( "+(((E=v[c==null?void 0:c.key])==null?void 0:E.name.length)<5?1.1:(($=v[c==null?void 0:c.key])==null?void 0:$.name.length)<6?1:((_=v[c==null?void 0:c.key])==null?void 0:_.name.length)<8?.9:.8)+")"},children:(O=v[c==null?void 0:c.key])==null?void 0:O.name})]},c==null?void 0:c.key))}}),new Array(3-n.length).fill(0).forEach((m,y)=>{n.push(t(d,{sx:{display:"flex",alignItems:"center",flexFlow:"wrap",maxWidth:"80px",position:"relative",userSelect:"none",fontSize:"40px",textAlign:"center",fontWeight:100,color:"#ccc"},children:t(d,{sx:{border:"1px solid #ccc",margin:"9px",lineHeight:"60px",width:"60px",height:"60px"},children:"/"})},y))}),n},[u,l,f.skillELevel,f.skillName,p,v,i]);return b(d,{sx:{position:"relative",width:"335px",userSelect:"none"},children:[t(d,{className:f.rankBox,children:t(d,{sx:n=>({padding:"10px"}),children:"Rank "+(((k=u[p])==null?void 0:k.level)>6?7:(z=(N=u[p])==null?void 0:N.level)!=null?z:1)})}),t(d,{sx:{transition:"all 0.5s",position:"absolute",top:9,right:16,fontWeight:700,opacity:e?0:1},children:"\u6280\u80FD"}),b(J,{withBorder:!0,shadow:"md",className:f.bottomBox,children:[t(d,{className:f.folderButton,children:t(Q,{variant:"subtle",sx:{width:"100%",height:"100%"},onClick:()=>r==null?void 0:r(!e),children:e?t(de,{size:30}):t(fe,{size:30})})}),t(he,{}),t(d,{className:f.detailBar,children:Object.keys(v).sort((n,m)=>v[n].index-v[m].index).map((n,m)=>{var y,P;return m<=l?b(d,{className:f.detailBarSlider,children:[t(d,{className:f.detailSkillName,children:(y=v[n])==null?void 0:y.name}),t(te,{value:(P=u[n])==null?void 0:P.level.toString(),onChange:E=>x==null?void 0:x(E,s,n),size:"xs",sx:{height:22.5},data:o})]},n):t(d,{className:a(f.detailBarSlider,f.detailBarSliderNoInfo),children:"NO INFO"},m)})})]}),t(G,{spacing:0,className:f.skillIconGroup,children:g})]})}function C({imgKey:s,width:e=256,flowWidthRef:r}){const{imgPositionMap:i}=A();return t(me,{url:"https://img.yituliu.site/static/uniequip_0.5.webp",width:e,originWidth:256,flowWidthRef:r,position:i.uniEquipImgPosition[s]})}const os=F((s,{fold:e})=>({container:{position:"relative",background:s.white,borderRadius:"10px",width:335,display:"flex",marginTop:"40px",height:"150px",overflow:"hidden"}}));function is({data:s,fold:e=!1,onClickFoldButton:r,onSelectUniEquipChange:i,onUniEquipLevelChange:x}){var v,g,k,N,z;const f=I.exports.useMemo(()=>[{value:"1",label:"\u4E00\u7EA7"},{value:"2",label:"\u4E8C\u7EA7"},{value:"3",label:"\u4E09\u7EA7"}],[]),{charMap:a}=A(),{classes:l,cx:u}=os({fold:e}),p=I.exports.useMemo(()=>{const n={};return Object.keys(a[s.key].equips).forEach((m,y)=>{if(y===0){n.default={...a[s.key].equips[m]};return}n[m]={...a[s.key].equips[m]}}),n},[a,s.key]),h=I.exports.useMemo(()=>{let n="",m="";const y=Object.keys(p).filter(P=>{var E,$;return P==="default"||(($=(E=s==null?void 0:s.modules)==null?void 0:E[P])==null?void 0:$.level)>0});if(y.length>0){const P=y.findIndex(E=>E===s.moduleUse);P>0&&(n=y[P-1]),P<y.length-1&&(m=y[P+1])}return{frontKey:n,backKey:m}},[s.moduleUse,s.modules,p]),o=I.exports.useCallback(n=>{const{frontKey:m,backKey:y}=h;if(n==="up"&&m){i==null||i(m);return}if(n==="down"&&y){i==null||i(y);return}},[h,i]);return b(d,{sx:{position:"relative",width:"335px",userSelect:"none"},children:[t(d,{sx:{transition:"all 0.5s",position:"absolute",width:"100%",top:"0px"},children:b(G,{position:"apart",mx:16,children:[t(le,{order:5,children:s.elite===2&&((v=p==null?void 0:p[s.moduleUse])==null?void 0:v.name)}),Object.keys(p).length>0&&s.elite===2&&b(G,{children:[Object.keys(s.modules).filter(n=>!n.includes("001")).map(n=>s.modules[n].level===0?t(oe,{size:"lg",onClick:()=>x==null?void 0:x(1,n),children:t(C,{imgKey:s.modules[n].key,width:30})},n):t(oe,{size:"lg",variant:"outline",color:"green",onClick:()=>x==null?void 0:x(0,n),children:t(C,{imgKey:s.modules[n].key,width:30})},n)),t(le,{order:5,children:"\u6A21\u7EC4"})]})]})}),t(J,{withBorder:!0,shadow:"md",className:l.container,children:Object.keys(p).length>0&&s.elite===2?b(Y,{children:[b(se,{sx:{width:"40px"},spacing:0,children:[t(Q,{variant:"subtle",radius:0,disabled:h.frontKey==="",sx:{height:75,padding:0},onClick:()=>o("up"),children:t(ze,{})}),t(Q,{variant:"subtle",radius:0,disabled:h.backKey==="",sx:{height:75,padding:0},onClick:()=>o("down"),children:t(_e,{})})]}),b(d,{sx:{flex:"1",display:"flex",flexDirection:"row-reverse"},children:[s.moduleUse!=="default"?b(Y,{children:[b(d,{sx:{transition:"all 0.5s",height:"100%",boxSizing:"border-box",padding:e?"10px 0":10,paddingTop:20,width:e?0:64,overflow:"hidden",position:"relative"},children:[t(d,{sx:{fontSize:"12px",fontWeight:700,textAlign:"center",minWidth:44},children:"\u7B49\u7EA7"}),t(Pe,{h:5}),t(te,{value:(k=(g=s.modules)==null?void 0:g[s.moduleUse])==null?void 0:k.level.toString(),onChange:n=>x==null?void 0:x(parseInt(n,10),s.moduleUse),data:f,size:"xs",orientation:"vertical"})]}),b(X,{sx:n=>({flex:"1",fontWeight:700,fontSize:"30px",cursor:"pointer",color:n.colors.blue[6]}),onClick:()=>r==null?void 0:r(!e),children:[b(d,{sx:n=>({border:"5px solid "+(e?n.colors.blue[6]:"#ccc"),width:"30px",height:"30px",zIndex:0,position:"relative"}),children:[t(d,{sx:{width:5,height:10,position:"absolute",background:"#fff",zIndex:1,top:"5px",left:"-5px"}}),t(d,{sx:{width:5,height:10,position:"absolute",background:"#fff",zIndex:1,bottom:"5px",right:"-5px"}})]}),t(d,{sx:{width:"18px",height:"40px",position:"absolute",background:"#fff",zIndex:1},children:(z=(N=s.modules)==null?void 0:N[s.moduleUse])==null?void 0:z.level})]})]}):t(X,{sx:{flex:"1",fontWeight:500,color:"#ccc"},children:"NO INFO"}),t(C,{imgKey:s.moduleUse,width:150}),t(d,{sx:{borderLeft:"1px solid #ccc"}})]})]}):t(X,{sx:{width:"100%",fontWeight:500,color:"#ccc"},children:"NO INFO"})})]})}const ns=F(s=>({container:{position:"relative",background:s.white,borderRadius:"10px",width:335,padding:"15px",boxSizing:"border-box",overflow:"auto","::-webkit-scrollbar":{display:"none"}}}));function cs({children:s}){const{classes:e,cx:r}=ns(),i=I.exports.useRef(null);return I.exports.useEffect(()=>{var f;const x=(f=i.current)==null?void 0:f.addEventListener("wheel",a=>{a.preventDefault(),i.current&&(i.current.scrollLeft+=a.deltaY/10)});return()=>{x&&removeEventListener("wheel",x)}},[]),t(J,{ref:i,className:e.container,shadow:"md",radius:"lg",p:"lg",withBorder:!0,children:s})}function as({data:s,selectedSkinKey:e,onSelectChange:r}){const{charMap:i}=A(),x=I.exports.useMemo(()=>{var a,l;const f=(l=(a=i[s==null?void 0:s.key])==null?void 0:a.skins)!=null?l:[];return Object.keys(f).map(u=>t(Ke,{charKey:u,onSelectChange:()=>r==null?void 0:r(u),sx:{background:s.skinUse===u?"yellow":void 0},dragDisabled:!0},u))},[i,s==null?void 0:s.key,s.skinUse,r]);return t(cs,{children:t(G,{sx:{marginRight:"20px"},children:x})})}const ye=Se(s=>({editingCharKey:"",updateEditingCharKey:e=>s(r=>({...r,editingCharKey:e}))}));class ee{constructor(){this.serviceName="charBox"}getCharBoxByUserId(e){return Z(this.serviceName,"getCharBoxByUserId",e)}createOne(e){return Z(this.serviceName,"createOne",e)}updateOne(e){return Z(this.serviceName,"updateOne",e)}}const us={id:"",userId:"",characterKeys:{},updatedDate:""};function ps(){const s=Ee();xe();const e=I.exports.useRef("char-box"),{user:r}=je(),{editingCharKey:i,updateEditingCharKey:x}=ye(),{isLoading:f,error:a,data:l}=$e(e.current,async()=>{var k,N,z;const{data:g}=await new ee().getCharBoxByUserId({userId:r.id});return g?(i===""&&x((z=(N=Object.keys((k=g.characterKeys)!=null?k:{}))==null?void 0:N[0])!=null?z:""),g):us}),u=L(async()=>l!=null&&l.id?await new ee().updateOne({charBox:{...l,userId:r.id}}):await new ee().createOne({charBox:{...l,userId:r.id}}),{onSuccess:()=>{}}),p=L(async g=>{s.setQueryData(e.current,g)},{onSuccess:()=>{u.mutate()}}),h=L(async g=>{const k={...l==null?void 0:l.characterKeys};k[g.key]={...g},p.mutate({...l,characterKeys:k})}),o=L(async g=>{({...l==null?void 0:l.characterKeys},p.mutate({...l,characterKeys:{...l==null?void 0:l.characterKeys,...g}}))}),v=L(async g=>{const k={...l==null?void 0:l.characterKeys};g.forEach(N=>delete k[N]),p.mutate({...l,characterKeys:k})});return{charBox:l,uploadCharBox:u,updateLocalCharBox:p,addCharToBox:o,delCharFromBox:v,updateChar:h,isLoading:f}}function gs(){var E,$,_;const[s,e]=I.exports.useState(!1),[r,i]=I.exports.useState(!1),[x,f]=I.exports.useState(!1),{charMap:a}=A(),{editingCharKey:l,updateEditingCharKey:u}=ye(),{charBox:p,updateChar:h}=ps(),o=(E=p==null?void 0:p.characterKeys)==null?void 0:E[l],v=o!=null&&o.key?a[o.key].rarity:0,g=($=(o==null?void 0:o.key)&&a[o.key].maxPotentialLevel)!=null?$:0;I.exports.useEffect(()=>{o||u(Object.keys(a)[0])},[a,o,u]);const[k]=I.exports.useState([0,0,1,2,2,2]),[N]=I.exports.useState([[30,30,40,40,50,50],[0,0,55,60,70,80],[0,0,0,70,80,90]]),[z,n]=I.exports.useState({potentialLevel:[0,0],trust:[0,200]});I.exports.useEffect(()=>{n(O=>({...O,potentialLevel:[0,g]}))},[g]);const m=I.exports.useCallback((O,c,j)=>{const K=parseInt(O,10),B={...c.skills};return K<=7&&c.skills[j].level<=7||K<7&&c.skills[j].level>=7?Object.keys(B).forEach(W=>{W!==j&&(B[W]={...B[W],level:K})}):K>7&&c.skills[j].level<7&&Object.keys(B).forEach(W=>{W!==j&&(B[W]={...B[W],level:7})}),Object.keys(B).forEach(W=>{W===j&&(B[W]={...B[W],level:K})}),B},[]),y=I.exports.useCallback(O=>{var re;let c=0,j="",K=-1;Object.keys((re=o==null?void 0:o.skills)!=null?re:{}).forEach((w,M)=>{w===(o==null?void 0:o.skillUse)&&(K=M),O.elite>=M&&(c=M,j=w)});const B={...o==null?void 0:o.modules};let W=!1;(o==null?void 0:o.modules)&&O.elite!==(o==null?void 0:o.elite)&&(W=!0,Object.keys(B).forEach((w,M)=>{B[w]={...B[w],level:1}}));const S={...O};if(isNaN(S.level)?S.level=1:S.level>N[S.elite][v]?S.level=N[S.elite][v]:S.level<1?S.level=1:S.level=Math.floor(S.level),Object.keys(z).forEach(w=>{["potentialLevel","trust"].includes(w)&&(isNaN(S[w])||S[w]<z[w][0]?S[w]=z[w][0]:S[w]>z[w][1]?S[w]=z[w][1]:S[w]=Math.floor(S[w]))}),o){const w={...o,...S,skillUse:K>c?j:o==null?void 0:o.skillUse,modules:B,moduleUse:W?"default":o==null?void 0:o.moduleUse};Object.keys(o==null?void 0:o.skills).forEach((M,ds)=>{O.elite!==(o==null?void 0:o.elite)&&(c<1?w.skills=m==null?void 0:m("4",w,M):w.skills=m==null?void 0:m("7",w,M))}),h.mutate(w)}},[z,o,N,m,v,h]),P=I.exports.useCallback((O,c)=>{if(o){const j={...o==null?void 0:o.modules};j[c]={...j[c],level:O},h.mutate({...o,moduleUse:O===0?"default":o.moduleUse,modules:j})}},[o,h]);return t(G,{position:"center",sx:{alignItems:"flex-start",flex:"1"},children:o&&b(Y,{children:[b(se,{children:[t(as,{data:o,selectedSkinKey:o==null?void 0:o.skinUse,onSelectChange:O=>h.mutate({...o,skinUse:O})}),t(Ce,{fold:r,verifyRule:z,maxEliteVerifyRule:k,maxLevelVerifyRule:N,onClickFoldButton:i,data:o,onCharBasicDataChange:y})]}),b(se,{children:[t(ls,{fold:s,onClickFoldButton:e,data:o,onSelectSkillChange:O=>h.mutate({...o,skillUse:O}),onSkillLevelChange:(O,c,j)=>{h.mutate({...c,skills:m(O,c,j)})}}),Object.keys((_=a[o==null?void 0:o.key])==null?void 0:_.equips).length>0&&t(is,{fold:x,onClickFoldButton:f,data:o,onSelectUniEquipChange:O=>h.mutate({...o,moduleUse:O}),onUniEquipLevelChange:P})]})]})})}export{gs as I,ps as a,ye as u};
