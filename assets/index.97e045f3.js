import{E as T,x as K,u as $,r as F,j as e,G as C,C as V,d as q,b as x,ao as ae,P as he,y as O,Q as D,ap as ne,aq as X,c as L,ar as ue,as as ie,at as te,F as w,am as v,B as M,V as se,W as le,au as xe,T as oe,S as pe,ae as z,af as Fe,an as N,av as ge,aw as Ee,ax as me,ay as fe,e as Y}from"./index.89d34bc2.js";import{I as G,a as re,u as ce}from"./Header.2b1f0bb0.js";import{u as ye,a as H,I as ke,b as Ce}from"./index.c618fb25.js";import{m as S,I as P,a as Be,b as Ie}from"./PageContainer.8d24c617.js";import{C as Q}from"./index.1d958a9a.js";import{D as k}from"./DraggableCharContainer.6c496cc7.js";import"./use-uncontrolled.a66842b5.js";import"./use-id.c6e2f14a.js";import"./useQuery.38d53892.js";import"./TextInput.4f439b0a.js";import"./SegmentedControl.653edd9d.js";import"./Container.01492b1d.js";function de({filterChar:n}){const{charMap:l}=T(),{setting:t}=K(),{t:u}=$(),{editingCharKey:o,updateEditingCharKey:i}=ye(),{charBox:c}=H(),r=F.exports.useMemo(()=>{var s;return(s=c==null?void 0:c.characterKeys)!=null?s:{}},[c==null?void 0:c.characterKeys]),a=F.exports.useMemo(()=>S(l).filter(s=>!s.isNotObtainable&&Object.keys(r).filter(p=>p===s.key).length>0&&n(s)).map(s=>{var p,f;return e(Q,{selecting:o===(s==null?void 0:s.key),onSelectChange:()=>i(s==null?void 0:s.key),charKey:(p=r[s.key].skinUse)!=null?p:"",charName:(f=s==null?void 0:s.name)!=null?f:"",nameDisplay:t.nameDisplay,mini:t.mini,dragDisabled:!0},r[s.key].skinUse)}),[r,l,o,n,t.mini,t.nameDisplay,i]);return a.length>0?e(C,{spacing:10,position:"center",children:a}):e(V,{sx:{height:"100%"},children:e(q,{color:"#ccc",children:u("no-qualified")})})}function Ae({filterChar:n,onClickFilter:l}){const{setting:t,setSettingKeyValue:u}=K(),{charMap:o}=T(),{charBox:i}=H(),c=F.exports.useMemo(()=>{var a;return(a=i==null?void 0:i.characterKeys)!=null?a:{}},[i==null?void 0:i.characterKeys]),r=F.exports.useMemo(()=>{const a=S(c);return S(o).filter(s=>a.findIndex(p=>p.key===s.key)>-1&&n(s))},[o,c,n]);return x(ae,{position:{bottom:0,right:0},zIndex:100,children:[e(k,{}),x(he,{radius:0,p:"md",sx:{width:"100vw",height:"200px",display:"flex"},children:[x(O,{pr:10,children:[e(D,{size:"lg",onClick:()=>u("charBoxEditing",!t.charBoxEditing),children:e(ne,{})}),e(G,{label:r.length,size:16,children:e(D,{size:"lg",onClick:l,children:e(X,{})})})]}),e(L,{sx:{height:"100%",overflow:"auto",flex:1},children:e(de,{filterChar:n})})]})]})}function Se({character:n,selecting:l,onSelect:t,onSelectCancel:u}){var c,r;const{setting:o}=K(),i=a=>{var s,p;a?t==null||t((s=n==null?void 0:n.key)!=null?s:""):u==null||u((p=n==null?void 0:n.key)!=null?p:"")};return e(Q,{nameDisplay:o.nameDisplay,charKey:(c=n==null?void 0:n.key)!=null?c:"",charName:(r=n==null?void 0:n.name)!=null?r:"",mini:o.mini,selecting:l,dragDisabled:!0,sx:{zIndex:0},onSelectChange:i})}function Z({filterCharData:n,selectKeys:l,...t}){const{t:u}=$(),o=F.exports.useMemo(()=>n.map((i,c)=>{var r;return e(Se,{selecting:l.findIndex(a=>a===(i==null?void 0:i.key))>-1,character:i,...t},(r=i==null?void 0:i.key)!=null?r:"")}),[n,t,l]);return e(C,{spacing:10,position:"center",children:o.length>0?o:e(V,{children:e(q,{color:"#ccc",children:u("no-qualified")})},"none")})}function De({filterChar:n,onClickFilter:l}){const{charMap:t}=T(),{charBox:u,addCharToBox:o,delCharFromBox:i,isLoading:c}=H(),{setting:r,setSettingKeyValue:a}=K();$();const[s,p]=F.exports.useState([]),[f,y]=F.exports.useState([]),I=F.exports.useMemo(()=>{var m;const h=S((m=u==null?void 0:u.characterKeys)!=null?m:{});return S(t).filter(g=>h.findIndex(b=>b.key===g.key)>-1&&n(g))},[u,t,n]),B=F.exports.useMemo(()=>S(t).filter(h=>h.isNotObtainable?!1:I.findIndex(m=>m.key===h.key)===-1&&n(h)),[t,I,n]),j=B.length!==0&&B.length===f.length,U=()=>{y(j?[]:B.map(h=>h.key))},d=()=>{i.mutate(s),p([])},E=()=>{const h=[...B].filter(g=>f.findIndex(b=>b===g.key)>-1),m={};h.forEach(g=>{var R;const b={};Object.keys({...g.skills}).forEach(A=>{b[A]={level:1,key:A}});const J={};Object.keys({...g.equips}).forEach(A=>{J[A]={level:0,key:A}}),m[g.key]={key:g.key,moduleUse:"",skillUse:(R=Object.keys(g.skills).find(A=>g.skills[A].index===0))!=null?R:"",skinUse:Object.keys(g.skins)[0],favorite:!1,level:1,elite:0,trust:200,potentialLevel:0,skills:b,modules:J}}),o.mutate(m),y([])};return e(P,{loading:c,children:x(O,{children:[e(re,{title:r.charBoxEditing?"\u5E72\u5458\u76D2":"\u6301\u6709\u7F16\u8F91",children:x(C,{position:"right",spacing:10,children:[!r.charBoxEditing&&e(D,{size:"lg",radius:"md",onClick:U,children:j?e(ue,{}):f.length!==0?e(ie,{}):e(te,{})}),e(G,{label:r.charBoxEditing?I.length:B.length,size:16,children:e(D,{size:"lg",radius:"md",onClick:l,children:e(X,{})})})]})}),e(k,{}),r.charBoxEditing?e(v,{sx:{height:r.charBoxEditing?"850px":"370px"},children:e(de,{filterChar:n})}):x(w,{children:[e(v,{sx:{height:"370px"},children:e(Z,{filterCharData:B,selectKeys:f,onSelect:h=>y([...f,h]),onSelectCancel:h=>y(m=>m.filter(g=>g!==h))})}),e(k,{}),x(C,{position:"center",children:[e(M,{leftIcon:e(se,{}),size:"xs",color:"red",variant:"outline",onClick:d,children:"\u79FB\u81F3\u672A\u6301\u6709"}),e(M,{leftIcon:e(le,{}),size:"xs",variant:"outline",onClick:E,children:"\u79FB\u81F3\u5DF2\u6301\u6709"})]}),e(k,{}),e(v,{sx:{height:r.charBoxEditing?"":"370px"},children:e(Z,{filterCharData:I,selectKeys:s,onSelect:h=>p([...s,h]),onSelectCancel:h=>p(m=>m.filter(g=>g!==h))})})]}),e(k,{}),e(C,{position:"center",children:e(M,{variant:r.charBoxEditing?"outline":"filled",color:"indigo",leftIcon:e(ne,{}),onClick:()=>a("charBoxEditing",!r.charBoxEditing),children:r.charBoxEditing?"\u7EC3\u5EA6\u7F16\u8F91\u6A21\u5F0F":"\u6301\u6709\u7F16\u8F91\u6A21\u5F0F"})})]})})}function be(){const{setting:n}=K(),{downSM:l}=xe(),{setOpened:t,drawerContext:u,filterChar:o}=ce();return x(w,{children:[n.charBoxEditing&&l?!n.menuOpened&&e(Ae,{filterChar:o,onClickFilter:()=>t(!0)}):e(De,{filterChar:o,onClickFilter:()=>t(!0)}),n.charBoxEditing&&e(ke,{}),u]})}function Ke(){return x(P,{children:[e(oe,{order:5,children:"\u586B\u5199\u4F60\u7684 BOX \u4E0E\u76AE\u80A4\u6301\u6709\u60C5\u51B5"}),e(pe,{h:5}),x(z,{children:[e(z.Item,{children:"\u8FDB\u5165\u9875\u9762\u540E\uFF0C\u5148\u9009\u62E9\u4F60\u6301\u6709\u7684\u5E72\u5458\uFF0C\u4FDD\u5B58\u540E\u70B9\u51FB\u6700\u4E0B\u65B9\u7684\u3010\u6301\u6709\u7F16\u8F91\u6A21\u5F0F\u3011\u6309\u94AE\u5207\u6362\u5230\u3010\u7EC3\u5EA6\u7F16\u8F91\u6A21\u5F0F\u3011\u9875\u9762\u3002"}),e(z.Item,{children:"\u76AE\u80A4\u76D2\u529F\u80FD\u9884\u8BA1\u4E8E 0.5 \u7248\u672C\u66F4\u65B0\uFF0C\u5728\u6B64\u4E4B\u524D\u6240\u6709\u76AE\u80A4\u7686\u53EF\u81EA\u7531\u9009\u62E9\uFF0C\u5F85\u529F\u80FD\u66F4\u65B0\u540E\u8BF7\u5148\u63D0\u4EA4\u4E00\u6B21\u76AE\u80A4\u6301\u6709\u60C5\u51B5\uFF0C\u4E4B\u540E\u4FBF\u53EF\u6B63\u5E38\u7F16\u8F91 BOX\u3002"}),e(z.Item,{children:e("del",{children:"\u4F60\u53EF\u4EE5\u5207\u6362\u4F60\u5DF2\u7ECF\u6301\u6709\u7684\u5E72\u5458\u76AE\u80A4\uFF0C\u7CBE\u4E8C\u76AE\u80A4\u5728\u7CBE\u4E8C\u540E\u89E3\u9501\u3002"})}),e(z.Item,{children:e("del",{children:"\u8981\u60F3\u89E3\u9501\u672A\u6301\u6709\u7684\u5E72\u5458\u76AE\u80A4\uFF0C\u8BF7\u70B9\u51FB\u5E72\u5458\u76AE\u80A4\u53F3\u4E0A\u89D2\u7684\u3010+\u3011\u6309\u94AE\uFF0C\u6B64\u64CD\u4F5C\u4F1A\u63D0\u4EA4\u81F3\u76AE\u80A4\u76D2\u66F4\u6539\u3002"})})]})]})}const _=[{value:"char",label:"\u5E72\u5458 BOX \u7F16\u8F91",icon:e(me,{})},{value:"skin",label:"\u76AE\u80A4\u6301\u6709\u7F16\u8F91",icon:e(fe,{})}];function Oe({inside:n,onInside:l}){var o;const[t,u]=F.exports.useState(0);return x(w,{children:[e(Be,{title:n?(o=_[t])==null?void 0:o.label:"\u5E72\u5458\u6570\u636E",inside:n,children:e(D,{size:"md",children:e(Fe,{onClick:()=>l==null?void 0:l(!1)})})}),!n&&x(w,{children:[e(Ke,{}),e(P,{children:x(O,{children:[e(C,{noWrap:!0,children:_.map((i,c)=>e(N,{onClick:()=>{u(c),l==null||l(!0,i.value)},children:e(W,{label:i.label,topIcon:i.icon,titleProps:{sx:{fontSize:"16px",width:"100%"}},groupsSx:{alignItems:"center",justifyContent:"center"}})},c))}),e(k,{}),x(C,{noWrap:!0,children:[e(N,{sx:{textAlign:"center"},disabled:!0,children:e(W,{label:"\u5FEB\u901F\u5BFC\u5165\u6570\u636E",topIcon:e(ge,{}),titleProps:{sx:{fontSize:"16px",width:"100%"}},groupsSx:{alignItems:"center",justifyContent:"center"}})}),e(N,{sx:{textAlign:"center"},disabled:!0,children:e(W,{label:"\u5BFC\u51FA\u6570\u636E",topIcon:e(Ee,{}),titleProps:{sx:{fontSize:"16px",width:"100%"}},groupsSx:{alignItems:"center",justifyContent:"center"}})})]})]})})]})]})}const W=({label:n,description:l,titleProps:t,groupsSx:u,topIcon:o,sx:i,...c})=>e(L,{sx:i,...c,children:x(O,{sx:{height:"100%",alignItems:"flex-start",...u},children:[o,x(L,{children:[e(oe,{order:5,...t,children:n}),x(q,{size:"xs",color:"dimmed",children:[l&&e(k,{}),l]})]})]})});function ze({data:n,selecting:l,onSelect:t,onSelectCancel:u}){var c;const{setting:o}=K(),i=r=>{var a,s;r?t==null||t((a=n==null?void 0:n.skinKey)!=null?a:""):u==null||u((s=n==null?void 0:n.skinKey)!=null?s:"")};return e(Q,{charKey:(c=n==null?void 0:n.skinKey)!=null?c:"",mini:o.mini,selecting:l,dragDisabled:!0,sx:{zIndex:0},onSelectChange:i})}function ee({filterData:n,selectKeys:l,...t}){const{t:u}=$(),o=F.exports.useMemo(()=>n.map((i,c)=>{var r;return e(ze,{data:i,selecting:l.findIndex(a=>a===(i==null?void 0:i.skinKey))>-1,...t},(r=i==null?void 0:i.skinKey)!=null?r:"")}),[n,t,l]);return e(C,{spacing:10,position:"center",children:o.length>0?o:e(V,{children:e(q,{color:"#ccc",children:u("no-qualified")})},"none")})}function ve({filterChar:n,onClickFilter:l}){const{charMap:t}=T();$();const{skinBox:u,updateLocalSkinBox:o,isLoading:i}=Ce(),[c,r]=F.exports.useState([]),[a,s]=F.exports.useState([]),p=F.exports.useMemo(()=>{let d=[];return S(t).forEach((E,h)=>{d.push(...Object.keys(E.skins).map(m=>({skinKey:m,...E})).filter(m=>m.skinKey.includes("#")))}),d},[t]),f=F.exports.useMemo(()=>p.filter(d=>{var E;return((E=u==null?void 0:u.charSkinKeys)==null?void 0:E.find(h=>h===d.skinKey))&&n(d)}),[p,n,u==null?void 0:u.charSkinKeys]),y=F.exports.useMemo(()=>p.filter(d=>f.findIndex(E=>E.key===d.key)===-1&&n(d)),[p,n,f]),I=y.length!==0&&y.length===a.length,B=()=>{s(I?[]:y.map(d=>d.skinKey))},j=()=>{var d;if(a.length===0){Y("\u8BF7\u5148\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A\u672A\u6301\u6709\u7684\u76AE\u80A4\uFF01");return}o.mutate({...u,charSkinKeys:[...(d=u==null?void 0:u.charSkinKeys)!=null?d:[],...a]}),s([])},U=()=>{var d;if(c.length===0){Y("\u8BF7\u5148\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A\u5DF2\u6301\u6709\u7684\u76AE\u80A4\uFF01");return}o.mutate({...u,charSkinKeys:(d=u==null?void 0:u.charSkinKeys)==null?void 0:d.filter(E=>!c.includes(E))}),r([])};return e(P,{loading:i,children:x(O,{children:[e(re,{title:"\u6301\u6709\u7F16\u8F91",children:x(C,{position:"right",spacing:10,children:[e(D,{size:"lg",radius:"md",onClick:B,children:I?e(ue,{}):a.length!==0?e(ie,{}):e(te,{})}),e(G,{label:y.length,size:16,children:e(D,{size:"lg",radius:"md",onClick:l,children:e(X,{})})})]})}),e(k,{}),e(v,{sx:{height:"370px"},children:e(ee,{filterData:y,selectKeys:a,onSelect:d=>s([...a,d]),onSelectCancel:d=>s(E=>E.filter(h=>h!==d))})}),e(k,{}),x(C,{position:"center",children:[e(M,{leftIcon:e(se,{}),size:"xs",color:"red",variant:"outline",onClick:U,children:"\u79FB\u81F3\u672A\u6301\u6709"}),e(M,{leftIcon:e(le,{}),size:"xs",variant:"outline",onClick:j,children:"\u79FB\u81F3\u5DF2\u6301\u6709"})]}),e(k,{}),e(v,{sx:{height:"370px"},children:e(ee,{filterData:f,selectKeys:c,onSelect:d=>r([...c,d]),onSelectCancel:d=>r(E=>E.filter(h=>h!==d))})})]})})}function Me(){const{setOpened:n,drawerContext:l,filterChar:t}=ce();return x(w,{children:[e(ve,{filterChar:t,onClickFilter:()=>n(!0)}),l]})}function Ge(){const[n,l]=F.exports.useState(!1),[t,u]=F.exports.useState("char");return e(Ie,{children:x(O,{children:[e(Oe,{inside:n,onInside:(o,i)=>{l(o),u(i!=null?i:"")}}),n&&e(L,{sx:{display:"flex",gap:"20px",flexWrap:"wrap"},children:t==="char"?e(be,{}):e(Me,{})})]})})}export{Ge as default};
